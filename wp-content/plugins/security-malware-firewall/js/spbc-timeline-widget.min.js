class SpbcTimelineWidget{static markerRadius=4;static hoursRangeMax=24;static axisStepsCount=6;static userActionsUpstep=12;static legendCircleX=-100;static legendTextX=-85;constructor(){this.now=new Date,this.currentTimestamp=Math.floor(this.now.getTime()/1e3),this.eventsData=null,this.timelineMarkersData=[],this.timelineKnownEventsData=[],this.timelineEventTooltip=null,this.timelineStartTimestamp=this.currentTimestamp-3600*SpbcTimelineWidget.hoursRangeMax}render(){var e;"undefined"!=typeof spbcTimelineWidgetData&&(this.timelineEventTooltip=document.getElementById("spbc-timeline-tooltip"),this.eventsData=spbcTimelineWidgetData.users_actions,this.timelineStartTimestamp=Number(spbcTimelineWidgetData.first_event_timestamp),this.timelineKnownEventsData=spbcTimelineWidgetData.known_events_data,this.timelineMarkersData=this.generateMarkersData(spbcTimelineWidgetData.found_types),(e=document.querySelector(".spbc_tab_section--active"))&&"spbc_tab-security_log"===e.id&&this.initTimeline(),window.addEventListener("spbctTabLoaded",e=>{"security_log"===e.detail.tab&&this.initTimeline()}),window.addEventListener("resize",()=>{var e=document.getElementById("spbc-timeline-user-select");e.value&&this.drawUserTimeline(e.value)}))}initTimeline(){let t=document.getElementById("spbc-timeline-user-select");var e=Object.keys(this.eventsData);t.innerHTML="",e.forEach(e=>{t.appendChild(new Option(e,e))}),t.addEventListener("change",()=>{this.drawUserTimeline(t.value)}),0<e.length?this.drawUserTimeline(e[0]):(document.querySelector(".spbc-timeline-container").style.display="none",document.querySelector(".spbc-timeline-controls").style.display="none",document.getElementById("spbc-timeline-no-data").style.display="block")}drawTimeAxis(t,i,n){var s=this.currentTimestamp-this.timelineStartTimestamp,e=document.createElementNS("http://www.w3.org/2000/svg","line");e.setAttribute("class","spbc-timeline-axis"),e.setAttribute("x1","0"),e.setAttribute("y1",n),e.setAttribute("x2",i),e.setAttribute("y2",n),t.appendChild(e);for(let e=0;e<=SpbcTimelineWidget.axisStepsCount;e++){var a=this.timelineStartTimestamp+e/SpbcTimelineWidget.axisStepsCount*s,r=e/SpbcTimelineWidget.axisStepsCount*i,l=document.createElementNS("http://www.w3.org/2000/svg","line"),l=(l.setAttribute("class","spbc-timeline-axis"),l.setAttribute("x1",r),l.setAttribute("y1",n),l.setAttribute("x2",r),l.setAttribute("y2",n+5),t.appendChild(l),document.createElementNS("http://www.w3.org/2000/svg","text")),r=(l.setAttribute("class","spbc-timeline-axis-text"),l.setAttribute("x",r),l.setAttribute("y",n+20),new Date(1e3*a));l.textContent=r.getHours().toString().padStart(2,"0")+":"+r.getMinutes().toString().padStart(2,"0"),t.appendChild(l)}}createEventElement(e,t,i,n){var s=document.createElementNS("http://www.w3.org/2000/svg","g"),t=(s.setAttribute("transform",`translate(${t}, ${i})`),s.setAttribute("data-event",JSON.stringify({...e,user:n})),document.createElementNS("http://www.w3.org/2000/svg","circle"));return t.setAttribute("class","spbc-timeline-event-marker"),t.setAttribute("r",SpbcTimelineWidget.markerRadius),t.style.fill=this.timelineMarkersData[e.event].color,s.appendChild(t),s.addEventListener("mouseenter",this.showEventTooltip.bind(this)),s.addEventListener("mouseleave",this.hideEventTooltip.bind(this)),s}showEventTooltip(e){var{user:e,event:t,time:i}=JSON.parse(e.currentTarget.getAttribute("data-event"));document.getElementById("spbc-timeline-tooltip--user").innerText=e,document.getElementById("spbc-timeline-tooltip--event").innerText=t,document.getElementById("spbc-timeline-tooltip--time").innerText=new Date(1e3*i).toISOString().replace(/T/," ").replace(/\..+/,""),this.timelineEventTooltip.style.opacity="1"}hideEventTooltip(){this.timelineEventTooltip.style.opacity="0"}drawUserTimeline(a){var e=document.getElementById("spbc-timeline-svg"),t=document.getElementById("spbc-timeline-no-data"),i=(e.innerHTML="",t.style.display="none",e.parentElement.clientWidth),r=e.parentElement.clientHeight;let l=0;5<spbcTimelineWidgetData.found_types.length&&(l=12*(spbcTimelineWidgetData.found_types.length-5)),e.setAttribute("width",i),e.setAttribute("height",r+l);const n=30,s=40,m=50,c=120;let d=i-c-s;i=r-n-m;let o=document.createElementNS("http://www.w3.org/2000/svg","g");o.setAttribute("transform",`translate(${c}, ${n})`),e.appendChild(o),this.drawTimeAxis(o,d,i);r=(this.eventsData[a]||[]).filter(e=>e.time>=this.timelineStartTimestamp&&e.time<=this.currentTimestamp);if(0===r.length)t.style.display="block";else{let n=i/2+l,s=this.currentTimestamp-this.timelineStartTimestamp;var p=spbcTimelineWidgetData.found_types.length;for(let e=0;e<p;e++){var u=n-SpbcTimelineWidget.userActionsUpstep*e,b=spbcTimelineWidgetData.found_types[e],h=this.timelineMarkersData[b].color,g=document.createElementNS("http://www.w3.org/2000/svg","line"),g=(g.setAttribute("class","spbc-timeline-user-line"),g.setAttribute("x1","0"),g.setAttribute("y1",u),g.setAttribute("x2",d),g.setAttribute("y2",u),o.appendChild(g),document.createElementNS("http://www.w3.org/2000/svg","circle")),h=(g.setAttribute("class","spbc-timeline-legend-circle"),g.setAttribute("cx",SpbcTimelineWidget.legendCircleX),g.setAttribute("cy",u),g.setAttribute("r",SpbcTimelineWidget.markerRadius),g.style.fill=h,o.appendChild(g),document.createElementNS("http://www.w3.org/2000/svg","text"));h.setAttribute("class","spbc-timeline-legend-text"),h.setAttribute("x",SpbcTimelineWidget.legendTextX),h.setAttribute("y",u),h.setAttribute("text-anchor","start"),h.setAttribute("dominant-baseline","middle"),h.textContent=b,o.appendChild(h)}r.forEach(e=>{var t=(e.time-this.timelineStartTimestamp)/s*d,i=n+this.timelineMarkersData[e.event].upstep;o.appendChild(this.createEventElement(e,t,i,a))})}}generateMarkersData(e){let t={},i=0,n="default";return e.forEach(e=>{this.timelineKnownEventsData[e]&&this.timelineKnownEventsData[e].color_scheme&&(n=this.timelineKnownEventsData[e].color_scheme),t[e]={color:n,upstep:i},i-=SpbcTimelineWidget.userActionsUpstep}),t}}function spbcTimelineWidgetRender(){(new SpbcTimelineWidget).render()}
//# sourceMappingURL=spbc-timeline-widget.min.js.map
